# 本番環境でのテスト

## 概要

従来はステージング環境やユーザー受け入れテスト（UAT）環境で行われていたテストを、エンドユーザーが利用する**本番環境**で実施するアプローチです。リスクは伴いますが、正しく実施すれば専用のテスト環境を維持するよりも信頼性が高く、効率的な検証が可能になります,。

## 詳細

*   **安全に実施するための手法**：本番環境でのテストを安全に行うため、以下のような技術的アプローチが用いられます。
    *   **機能フラグ**：新機能をフラグの後ろに隠してデプロイし、特定の条件下でのみ有効化してテストを行う。
    *   **カナリアデプロイ**：ごく一部のユーザーやサーバーに変更を適用し、問題がないか監視してから全体に展開する。
    *   **ブルーグリーンデプロイ**：2つの環境を用意し、非公開側でテストを行ってからトラフィックを切り替える。
    *   **自動ロールバック**：異常を検知した際に、自動的に変更を元に戻す仕組み。
    *   **マルチテナンシー**：テスト用テナントからのリクエストを識別し、本番データに影響を与えないよう処理（例：決済のモック化）を切り替える。
*   **メリット**：本番環境で実際に動作するという**確信**が得られること、本番データを用いたデバッグが容易であること、そして本番環境を模した複雑なテスト環境を維持・管理するコストを削減できることが挙げられます,。
*   **課題**：安全性を担保するために、マルチテナンシーへの対応や自動ロールバック機能など、インフラに対する多大な投資と準備が必要です。また、本番データ（個人情報など）へのアクセスに関するコンプライアンスや法的課題への配慮も不可欠です。

## ポイント

*   **究極の動作保証**：本番環境でテストを行うことで、「期待通りに動作する」という揺るぎない確信を得ることができます。
*   **インフラへの投資**：単に本番でテストを実行するのではなく、機能フラグや段階的ロールアウト、自動ロールバックといった**安全策**を講じるためのインフラ構築が前提となります,。
*   **環境の簡素化**：本番環境でのテスト体制が整えば、維持コストが高く本番との差異が生じやすい専用テスト環境の数を減らすことが可能になります。
