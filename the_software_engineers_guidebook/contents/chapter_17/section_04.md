# カナリアリリースと段階的ロールアウト

## 概要

**カナリアリリース**と**段階的ロールアウト**は、新しいコードを全ユーザーに一度に公開するリスクを避けるための手法です。
変更を一部のユーザーやサーバーにのみ適用して様子を見ることで、万が一バグがあった場合でも影響範囲（爆風半径）を最小限に抑え、問題がなければ徐々に適用範囲を広げていくアプローチです。

## 詳細

*   **カナリアリリース（Canary Release/Test）**:
    *   **由来**: 「炭鉱のカナリア」（有毒ガス検知のためにカナリアを連れて行った慣習）に由来します。ユーザーよりも先にシステム障害の兆候を検知する役割を果たします。
    *   **仕組み**: ロードバランサーなどでトラフィックの一部（例：1%）を新バージョンのコードにルーティングしたり、単一のサーバーのみにデプロイしたりして、問題がないか監視します。
*   **段階的ロールアウト（Staged Rollout）**:
    *   **プロセス**: カナリアリリースをさらに体系化したもので、変更を複数の段階に分けてリリースします。
    *   **例**: 「第1段階：ニュージーランドのユーザーの10%」→「第2段階：同100%」→「第3段階：全世界の10%」……「最終段階：全世界の100%」といったように、地域やユーザーの割合で段階を定義します。
    *   **進行基準**: 各段階で「予期せぬリグレッション（退行）がないか」「ビジネス指標が期待通りか」を確認し、問題がなければ次の段階へ進みます。

## ポイント

*   **本番環境での安全な検証**: テスト環境では発見できなかった問題を、全ユーザーに影響を与えることなく本番環境で検出できます。
*   **自動化とロールバック**: Meta（Facebook）などの先進的な企業では、このプロセスが自動化されており、メトリクスに異常が見られた場合、自動的にロールアウトを停止・ロールバックする仕組みが導入されています,。
*   **カナリアは段階的ロールアウトの一部**: カナリアリリースは、基本的には段階的ロールアウトの初期段階（単純化された一類型）と見なすことができます。
