# 機能フラグ

## 概要

**機能フラグ**とは、新しいコードや機能を条件分岐（フラグ）の後ろに隠してデプロイする手法です。これにより、コード自体は本番環境に存在していても、フラグを有効にしない限りユーザーには影響を与えない状態を作ることができます。開発中の機能を安全にメインブランチに統合したり、本番環境で安全にテストしたりするために不可欠な技術です。

## 詳細

*   **実装と仕組み**:
    *   実装は非常に単純で、`if (featureFlags.isEnabled("New_Feature")) { ... } else { ... }` のような条件分岐を用い、フラグが有効な場合のみ新しいコードを実行し、それ以外は古いコードを実行するようにします。
*   **主な用途**:
    *   **トランクベース開発**: 本番環境に出す準備が完全には整っていない機能であっても、フラグで隠すことで安全にメインブランチ（トランク）へコミット・マージすることができます。
    *   **A/Bテストと実験**: ユーザーを「実験群」と「統制群」に分け、特定のグループにのみ新機能を有効化してビジネス指標への影響を比較・評価するために利用されます。
    *   **モバイル/デスクトップアプリ**: バイナリとして配布されるアプリにおいて、配布後にコードの実行パスを制御するために使われます。
*   **運用プロセス**:
    *   コードをデプロイした後、まず社内ユーザーや一部のテストユーザーに対してフラグを有効化し、自動テストや手動テストを行います。問題がなければ対象ユーザーを徐々に拡大（段階的ロールアウト）していきます。

## ポイント

*   **デプロイとリリースの分離**: コードをサーバーに配置する「デプロイ」と、ユーザーが機能を使えるようにする「リリース」を切り離すことができます。これにより、リスクを抑えながら本番環境での検証が可能になります。
*   **技術的負債の管理（衛生管理）**: 最大の欠点は、使い終わった古いフラグがコードに残ると「技術的負債（コードの汚染）」になることです。ロールアウト完了後にはフラグを削除する「実験の衛生管理」が不可欠であり、UberのPiranhaのようなツールを用いて削除を自動化する企業もあります。
