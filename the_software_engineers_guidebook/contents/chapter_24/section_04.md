# アラート

## 概要

モニタリングを行っているメトリクス（指標）が「不健全」な状態を示した際に、エンジニアに通知を送るための仕組みがアラートです。本セクションでは、何をアラートの対象とすべきかの決定方法、緊急度による分類、アラートノイズ（誤報）の管理、そしてアラート発信のタイミングを決定する手法（静的閾値と異常検知）について解説されています。

## 詳細

*   **アラート対象の決定**:
    *   **健全性の定義**: ビジネスやプロダクトの観点から「健全」な状態と「不健全」な状態を定義し、不健全な状態を示すメトリクスにアラートを設定します。
    *   **過去の障害と顧客視点**: 過去のシステム障害で兆候となった指標や、顧客が気づくような異常（例：レイテンシーの悪化）を検知できるようにします。
*   **緊急度による分類**:
    *   **緊急（Urgent）**: 即時の確認と対応が必要なもの。プッシュ通知や電話発信を行い、応答がなければエスカレーションします。
    *   **非緊急（Non-urgent）**: 重要ではあるが、翌営業日の対応でも問題ないもの。
*   **アラートノイズの管理（精度と再現率）**:
    *   **精度（Precision）**: 発信されたアラートのうち、実際の障害であった割合。精度が高いほどノイズ（誤報）は少なくなります。
    *   **再現率（Recall）**: 発生した障害のうち、アラートが発信された割合。再現率が高いほど障害の見逃しが減ります。
    *   **トレードオフ**: ノイズを減らす（精度を上げる）と障害を見逃す（再現率が下がる）リスクが高まり、逆に障害検知を強化するとノイズが増える傾向にあります。
*   **閾値の設定方法**:
    *   **静的閾値（Static Thresholds）**: 「エラー数が毎分500を超えたら」のように手動で値を定義します。単純で理解しやすいですが、障害発生後に後追いで設定されがちです。
    *   **異常検知（Anomaly Detection）**: 機械学習を用いてトラフィックパターンの異常を検知します。多様な異常を検知できますが、設定が難しくノイズが増える可能性があります。

## ポイント

*   **健全と不健全の定義**: 何を監視すべきか迷ったときは、「健全」な状態とそうでない状態を言語化することで、アラート対象とすべきメトリクスが明確になります。
*   **精度と再現率のバランス**: 理想はノイズがなく全ての障害を検知することですが、現実にはトレードオフが存在するため、チームの状況に合わせてバランスを調整する必要があります。
*   **ハイブリッドなアプローチ**: 静的閾値と異常検知にはそれぞれ一長一短があるため、多くのメトリクスには異常検知を適用しつつ、想定内の変動や絶対的な限界値（ゼロになるなど）には静的閾値を使うという、両者の組み合わせが最も実用的です。
