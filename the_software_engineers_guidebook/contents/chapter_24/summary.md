# 第24章のまとめ

## 概要

スタッフ＋エンジニアには、自身の影響範囲内（所属チームや他チームを含む）において、システムの信頼性を担保し向上させる役割が期待されます。本章では、信頼性の計測から始まり、ログ記録、モニタリング、アラート、オンコール対応、インシデント管理、そしてレジリエント（回復力のある）なシステムの設計・開発に至るまで、信頼性の高いシステムを構築・維持するための包括的なアプローチが解説されています。

## 詳細

*   **信頼性の担保と計測**:
    *   信頼性を向上させるには、まず計測が必要です。OKRやKPI（例：レイテンシー、スループット、コールドスタート時間の改善など）を用いて目標を設定し、エンジニアリングマネージャーと協力して改善のためのリソースを確保します。
*   **ログ記録（Logging）**:
    *   本番環境でのデバッグにはログが不可欠です。ログレベル、構造、自動記録、保持期間などを考慮し、チーム内で一貫したログ記録の指針（何を、いつ、どのように記録するか）を設けることが推奨されます。
*   **モニタリング（Monitoring）**:
    *   システムの「健全性」を定義し、CPUやエラー率などのシステム指標だけでなく、ビジネス指標（例：注文数、決済成功数など）も監視します。ビジネス指標はシステムの不具合をより正確に反映することが多いためです。
    *   平均値だけでなく、p95やp99といったパーセンタイル値を監視し、一部のユーザーに起きている極端な遅延などを検知します。
*   **アラート（Alerting）**:
    *   アラートは緊急度（即時対応が必要か、翌営業日でよいか）で分類します。
    *   アラートのノイズ（誤報）を減らすため、精度（Precision）と再現率（Recall）のバランスを考慮し、静的閾値と異常検知を適切に組み合わせます。
*   **オンコールとインシデント管理**:
    *   **オンコール**: 持続可能な体制（理想は6人以上）を作り、対応手順書（ランブック）を整備して属人化を防ぎます。燃え尽き症候群を防ぐため、負担が過度にならないよう注意が必要です。
    *   **インシデント対応**: 発生時は「根本原因の究明」よりも「影響の緩和（復旧）」を最優先します。
    *   **事後分析（ポストモーテム）**: インシデント後は「非難なき振り返り」を行い、個人を責めるのではなく、システムやプロセスの欠陥を見つけ出して再発防止策を講じ、組織全体で学びを共有します。
*   **レジリエントなシステムの開発**:
    *   設計段階から障害を想定し、防御的コーディング、緩やかな機能劣化（Graceful Degradation）、再試行（リトライ）、サーキットブレーカーなどのパターンを導入して、障害が発生してもシステム全体がダウンしないようにします。

## ポイント

*   **緩和優先の原則**: 障害発生時は、原因究明に時間をかける前に、ロールバックや機能停止などの手段でまずユーザーへの影響を止める（緩和する）ことを優先します。
*   **非難なき文化**: インシデントから学ぶためには、個人のミスを責めるのではなく、ミスを許容してしまったシステムの不備に焦点を当てる「非難なきポストモーテム」が不可欠です。
*   **ビジネスメトリクスの重要性**: CPU使用率などの技術的な指標が正常でも、注文数がゼロであればシステムは死んでいます。ビジネス指標の監視は、システムの真の健全性を知るための鍵となります。
