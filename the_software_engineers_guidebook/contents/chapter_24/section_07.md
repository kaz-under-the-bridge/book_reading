# レジリエントなシステムの開発

## 概要

信頼性の高いシステムを運用するためには、将来発生しうる障害や想定外のユースケースをあらかじめ考慮し、**レジリエント（回復力のある）なシステム**として設計・コーディングすることが不可欠です。これには、計画段階での定義、防御的なコーディング、そして障害をシミュレーションしてシステムの反応をテストするプロセスが含まれます。

## 詳細

*   **計画策定段階**:
    *   **SLI（サービスレベル指標）の決定**: 「稼働時間（アップタイム）」の定義や目標値を明確にし、アーキテクチャーや運用方法の決定に反映させます。
    *   **障害・負荷・冗長性の計画**: どのような問題が起きうるか、想定される負荷（ピーク時含む）はどれくらいか、データの冗長性をどう確保するかを事前に計画します。また、モニタリングやアラートの対象も決定します。
*   **コーディング段階**:
    *   **防御的コーディング**: エッジケースを暗黙的ではなく明示的に処理します。
    *   **状態とエラーの管理**: 変数やAPIレスポンスなどのエラー状態に注意を払い、変更可能な状態を最小限にします（不変状態の活用）。また、「不明な状態（Unknown states）」を捕捉してログに記録し、潜在的な問題の温床にならないようにします。
*   **障害シミュレーションとテスト**:
    *   **グレースフル・デグラデーション（緩やかな機能劣化）**: 依存関係の一部が停止しても、システム全体がダウンせず、一部の機能を劣化させた状態で応答できるか確認します。
    *   **再試行（リトライ）とバックオフ**: 外部APIなどが停止した際の再試行戦略をテストします。
    *   **サーキット・ブレーカー**: 重要な依存関係でエラーが発生した場合に、接続を遮断（オープン）してシステムを守り、回復後に自動再開するパターンを導入します。
    *   **フェイルオーバーと災害復旧（DR）**: データセンター障害時の切り替えや、バックアップからの完全復旧を保証します。

## ポイント

*   **「失敗」を前提とした設計**: 障害は避けられないものとして扱い、依存サービスがダウンしてもシステム全体が停止しないよう、サーキット・ブレーカーやグレースフル・デグラデーションなどのパターンを実装することが重要です。
*   **不明な状態の排除**: 「良い」でも「悪い」でもない「不明」な状態は将来の問題の原因になりやすいため、これを検知してアラートを出す仕組みを組み込むべきです。
*   **継続的な改善**: 本番稼働後もパフォーマンスを継続的に確認し、インシデント管理プロセスを通じてシステムを微調整し続けることが、レジリエンスを維持する鍵となります。
