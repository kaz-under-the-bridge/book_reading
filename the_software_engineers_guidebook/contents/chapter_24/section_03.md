# モニタリング

## 概要

システムの健全性を判断する最も信頼性の高い方法は、重要な特性のモニタリングを実施し、数値が不健全な場合にアラートを出すことです。CPU使用率などの技術的な指標だけでなく、収益やユーザーアクションなどの**ビジネス指標**も監視対象に含めることで、システムが顧客にとって実際に正常に機能しているかどうかの全体像を把握する必要があります,。

## 詳細

*   **パーセンタイル（p50, p95, p99）の活用**:
    *   平均値だけを見ると、多くの顧客に影響を与える最悪のケースが隠れてしまう可能性があります。
    *   **p50（中央値）**: 平均的なユーザー体験を示します。
    *   **p95（95パーセンタイル）**: パフォーマンスが悪い上位5%を示します。ここにはパワーユーザー（ヘビーユーザー）が含まれることが多いため、特に重要な指標となります。
    *   **p99（99パーセンタイル）**: 最も遅い1%の外れ値を示します,。
*   **監視すべき技術的指標**:
    *   **全般**: アップタイム（稼働時間）、リソース使用率（CPU、メモリ、ディスク）、レスポンス時間、エラー率。
    *   **バックエンド**: HTTPステータスコード（5xxや4xxの急増）、レイテンシー。
    *   **フロントエンド/モバイル**: ページ読み込み時間、Core Web Vitals、アプリ起動時間、クラッシュ率、アプリサイズなど,,,。
*   **ビジネスメトリクスの監視**:
    *   技術的な指標が正常に見えても、システムが不健全（例：注文処理が止まっている）な場合があります。システムの「真の」健全性を知るにはビジネス指標が不可欠です。
    *   **監視例**: 新規登録数、特定アクション（支払い方法追加など）の成功率/エラー率、アクティブユーザー数（DAU/MAU）、収益、カスタマーサポートへのチケット数など,,。

## ポイント

*   **「平均」ではなく「分布」を見る**: 平均値は問題を覆い隠すため、p95やp99といったパーセンタイル値を監視し、一部のユーザーに発生している極端な遅延や問題を検知することが重要です。
*   **ビジネス指標が「現実」を語る**: CPUなどのインフラ指標は根本原因の特定に役立ちますが、ビジネス指標（注文数や収益など）こそが、システムが本来の目的を果たしているかどうかの現実を伝えてくれます。
*   **健全性の定義から始める**: 何を監視すべきかを決定するために、まずはそのシステムにとって「健全」とはどのような状態か、逆に「不健全」とは何かを定義することから始めます。
